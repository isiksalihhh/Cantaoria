/**
 * bootstrap-imageupload-src v1.2.0
 * https://github.com/nerdy-harry/bootstrap-imageupload
 * Copyright 2016 Egon Olieux
 * Released under the MIT license
 */

if("undefined"==typeof jQuery)throw new Error("bootstrap-imageupload's JavaScript requires jQuery.");!function(i){"use strict";function e(e){h=i.extend({},i.fn.imageupload.defaultOptions,e);var n=this,a=n.find(".file-tab"),d=n.find(".panel-heading .btn:eq(0)"),o=a.find('input[type="file"]'),r=a.find(".btn:eq(1)"),l=n.find(".url-tab"),s=n.find(".panel-heading .btn:eq(1)"),g=l.find(".btn:eq(0)"),w=l.find(".btn:eq(1)");p(a),b(l),f(a),t.call(n),d.off(),o.off(),r.off(),s.off(),g.off(),w.off(),d.on("click",function(){i(this).blur(),f(a)}),o.on("change",function(){i(this).blur(),u(a)}),r.on("click",function(){i(this).blur(),p(a)}),s.on("click",function(){i(this).blur(),m(l)}),g.on("click",function(){i(this).blur(),v(l)}),w.on("click",function(){i(this).blur(),b(l)}),""!==h.imgSrc&&(c(a,h.imgSrc),h.imgSrc="")}function n(){this.addClass("imageupload-disabled")}function t(){this.removeClass("imageupload-disabled")}function a(){var i=this;e.call(i,h)}function d(i){var e=[];return e.push('<div class="alert alert-danger alert-dismissible">'),e.push('<button type="button" class="close" data-dismiss="alert">'),e.push("<span>&times;</span>"),e.push("</button>"+i),e.push("</div>"),e.join("")}function o(i){return'<img src="'+i+'" alt="Image preview" class="thumbnail" style="max-width: '+h.maxWidth+"px; max-height: "+h.maxHeight+'px">'}function r(i){return i.substr(i.lastIndexOf(".")+1).toLowerCase()}function l(e,n){if(e.size/1024>h.maxFileSizeKb)return void n(!1,"File is too large (max "+h.maxFileSizeKb+"kB).");var t=r(e.name);i.inArray(t,h.allowedFormats)>-1?n(!0,"Image file is valid."):n(!1,"File type is not allowed.")}function s(e,n){var t=null,a=!1,d=new Image;d.onload=function(){if(!a){window.clearTimeout(t);var d=e;-1!==d.indexOf("?")&&(d=d.split("?")[0].split("#")[0]);var o=r(d);i.inArray(o,h.allowedFormats)>-1?n(!0,"Image URL is valid."):n(!1,"File type is not allowed.")}},d.onerror=function(){a||(window.clearTimeout(t),n(!1,"Image could not be found."))},d.src=e,t=window.setTimeout(function(){a=!0,d.src="???",n(!1,"Loading image timed out.")},3e3)}function f(i){var e=i.closest(".imageupload"),n=e.find(".panel-heading .btn:eq(0)");if(!n.hasClass("active")){var t=e.find(".url-tab");e.find(".panel-heading .btn:eq(1)").removeClass("active"),n.addClass("active"),t.hide(),i.show(),b(t)}}function p(i){i.find(".alert").remove(),i.find("img").remove(),i.find(".btn span").text("Browse"),i.find(".btn:eq(1)").hide(),i.find("input").val("")}function u(i){var e=i.find(".btn:eq(0)"),n=i.find(".btn:eq(1)"),t=e.find("input");if(i.find(".alert").remove(),i.find("img").remove(),e.find("span").text("Browse"),n.hide(),t[0].files&&t[0].files[0]){e.prop("disabled",!0);var a=t[0].files[0];l(a,function(r,l){if(r){var s=new FileReader;s.onload=function(t){i.prepend(o(t.target.result)),e.find("span").text("Change"),n.css("display","inline-block")},s.onerror=function(){i.prepend(d("Error loading image file.")),t.val("")},s.readAsDataURL(a)}else i.prepend(d(l)),e.find("span").text("Browse"),t.val("");e.prop("disabled",!1)})}}function c(i,e){var n=i.find(".btn:eq(0)"),t=i.find(".btn:eq(1)");n.find("input");i.find(".alert").remove(),i.find("img").remove(),n.find("span").text("Browse"),t.hide(),n.prop("disabled",!0),i.prepend(o(e)),n.find("span").text("Change"),t.css("display","inline-block"),n.prop("disabled",!1)}function m(i){var e=i.closest(".imageupload"),n=e.find(".panel-heading .btn:eq(1)");if(!n.hasClass("active")){var t=e.find(".file-tab");e.find(".panel-heading .btn:eq(0)").removeClass("active"),n.addClass("active"),t.hide(),i.show(),p(t)}}function b(i){i.find(".alert").remove(),i.find("img").remove(),i.find(".btn:eq(1)").hide(),i.find("input").val("")}function v(e){var n=e.find('input[type="text"]'),t=e.find(".btn:eq(0)"),a=e.find(".btn:eq(1)");e.find(".alert").remove(),e.find("img").remove(),a.hide();var r=n.val();if(!r)return void e.prepend(d("Please enter an image URL."));n.prop("disabled",!0),t.prop("disabled",!0),s(r,function(l,s){l?(e.find('input[type="hidden"]').val(r),i(o(r)).insertAfter(t.closest(".input-group")),a.css("display","inline-block")):e.prepend(d(s)),n.prop("disabled",!1),t.prop("disabled",!1)})}var h={},g={init:e,disable:n,enable:t,reset:a};i.fn.imageupload=function(e){var n=arguments;return this.filter("div").each(function(){if(g[e])g[e].apply(i(this),Array.prototype.slice.call(n,1));else{if("object"!=typeof e&&e)throw new Error('Method "'+e+'" is not defined for imageupload.');g.init.apply(i(this),n)}})},i.fn.imageupload.defaultOptions={allowedFormats:["jpg","jpeg","png","gif"],maxWidth:250,maxHeight:250,maxFileSizeKb:2048,imgSrc:""}}(jQuery);